# Telegraf Configuration for DigitalEgiz IoT System

[global_tags]
  environment = "digitalegiz"
  project = "iot-lorawan"

[agent]
  interval = "10s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "10s"
  flush_jitter = "0s"
  precision = ""
  hostname = "digitalegiz-telegraf"
  omit_hostname = false

###############################################################################
#                            OUTPUT PLUGINS                                  #
###############################################################################

# InfluxDB v2 output plugin
[[outputs.influxdb_v2]]
  urls = ["$INFLUXDB_URL"]
  token = "$INFLUXDB_TOKEN"
  organization = "$INFLUXDB_ORG"
  bucket = "$INFLUXDB_BUCKET"

###############################################################################
#                            INPUT PLUGINS                                   #
###############################################################################

# MQTT Consumer for ChirpStack events
[[inputs.mqtt_consumer]]
  servers = ["tcp://$MQTT_BROKER_HOST:1883"]
  topics = [
    "application/+/device/+/event/up",
    "application/+/device/+/event/join",
    "application/+/device/+/event/status",
    "gateway/+/event/up",
    "gateway/+/event/stats"
  ]
  client_id = "telegraf-digitalegiz"
  data_format = "json"
  json_time_key = "time"
  json_time_format = "2006-01-02T15:04:05.999999999Z07:00"
  
  # Tag configuration
  [[inputs.mqtt_consumer.tags]]
    topic_tag = "mqtt_topic"

# System metrics
[[inputs.system]]